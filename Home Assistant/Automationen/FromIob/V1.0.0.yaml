alias: Data FromIoB LoraWAN 0
description: EmpfÃ¤ngt Steuerbefehle von ioBroker via MQTT
triggers:
  - topic: lorawan_0/lorawan_0/lorawan_0_bridge_datafromiob/state
    trigger: mqtt
actions:
  - variables:
      payload: "{{ trigger.payload_json }}"
      entity_id: "{{ payload.keys() | list | first }}"
      value: "{{ payload[entity_id] }}"
      domain: "{{ entity_id.split('.')[0] }}"
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ domain == 'text' }}"
        sequence:
          - action: text.set_value
            target:
              entity_id: "{{ entity_id }}"
            data:
              value: "{{ value | string }}"
      - conditions:
          - condition: template
            value_template: "{{ domain == 'input_text' }}"
        sequence:
          - action: input_text.set_value
            target:
              entity_id: "{{ entity_id }}"
            data:
              value: "{{ value | string }}"
      - conditions:
          - condition: template
            value_template: "{{ domain in ['switch', 'light', 'input_boolean'] }}"
        sequence:
          - action: >
              {{ domain }}.turn_{{ 'on' if value in [true,'true','on','1',1]
              else 'off' }}
            target:
              entity_id: "{{ entity_id }}"
      - conditions:
          - condition: template
            value_template: "{{ domain == 'input_number' }}"
        sequence:
          - action: input_number.set_value
            target:
              entity_id: "{{ entity_id }}"
            data:
              value: "{{ value }}"
      - conditions:
          - condition: template
            value_template: "{{ domain == 'number' }}"
        sequence:
          - action: number.set_value
            target:
              entity_id: "{{ entity_id }}"
            data:
              value: "{{ value }}"
      - conditions:
          - condition: template
            value_template: "{{ domain == 'input_select' }}"
        sequence:
          - action: input_select.select_option
            target:
              entity_id: "{{ entity_id }}"
            data:
              option: "{{ value }}"
      - conditions:
          - condition: template
            value_template: "{{ domain == 'cover' }}"
        sequence:
          - action: >
              {{ 'cover.open_cover' if value in [true,'open','on','1',1] else
              'cover.close_cover' }}
            target:
              entity_id: "{{ entity_id }}"
      - conditions:
          - condition: template
            value_template: "{{ domain == 'lock' }}"
        sequence:
          - action: >
              {{ 'lock.lock' if value in [true,'lock','locked','on','1',1] else
              'lock.unlock' }}
            target:
              entity_id: "{{ entity_id }}"
  - action: system_log.write
    data:
      level: warning
      message: "ioBroker MQTT command ignored: {{ trigger.payload }}"
mode: queued
max: 10
